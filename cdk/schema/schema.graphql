# Popcorn Sales Manager GraphQL Schema
# Based on Planning Documents/graphql_schema_v1.md

# ============================================================================
# Scalars
# ============================================================================

scalar AWSDateTime
scalar AWSEmail
scalar AWSPhone
scalar AWSURL

# ============================================================================
# Enums
# ============================================================================

enum PermissionType {
  READ
  WRITE
}

enum PaymentMethod {
  CASH
  CHECK
  CREDIT_CARD
  OTHER
}

enum CatalogType {
  ADMIN_MANAGED
  USER_CREATED
}

# ============================================================================
# Core Types
# ============================================================================

type Account {
  accountId: ID!
  email: AWSEmail!
  givenName: String
  familyName: String
  city: String
  state: String
  unitType: String
  unitNumber: Int
  preferences: AWSJSON
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

type SellerProfile {
  profileId: ID!
  ownerAccountId: ID!
  sellerName: String!
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
  isOwner: Boolean!
  permissions: [PermissionType!]
}

type Season {
  seasonId: ID!
  profileId: ID!
  seasonName: String!
  seasonYear: Int!
  startDate: AWSDateTime!
  endDate: AWSDateTime
  catalogId: ID!
  unitType: String          # NEW: Optional unit information
  unitNumber: Int           # NEW: Required when unitType provided
  city: String              # NEW: Required when unitType provided (for unit uniqueness)
  state: String             # NEW: Required when unitType provided (for unit uniqueness)
  prefillCode: String       # NEW: If season was created from campaign prefill
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
  catalog: Catalog
  totalOrders: Int
  totalRevenue: Float
}

type Catalog @aws_cognito_user_pools {
  catalogId: ID!
  catalogName: String!
  catalogType: CatalogType!
  ownerAccountId: ID
  isPublic: Boolean!
  products: [Product!]!
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

type Product @aws_cognito_user_pools {
  productId: ID!
  productName: String!
  description: String
  price: Float!
  sortOrder: Int!
}

type CampaignPrefill {
  prefillCode: String!
  catalogId: ID!
  catalog: Catalog!
  seasonName: String!
  seasonYear: Int!
  startDate: AWSDate
  endDate: AWSDate
  unitType: String!
  unitNumber: Int!
  city: String!
  state: String!
  createdBy: ID!
  createdByName: String!
  creatorMessage: String!
  description: String
  isActive: Boolean!
  createdAt: AWSDateTime!
}

type Order {
  orderId: ID!
  profileId: ID!
  seasonId: ID!
  customerName: String!
  customerPhone: String
  customerAddress: Address
  orderDate: AWSDateTime!
  paymentMethod: PaymentMethod!
  lineItems: [LineItem!]!
  totalAmount: Float!
  notes: String
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

type LineItem {
  productId: ID!
  productName: String!
  quantity: Int!
  pricePerUnit: Float!
  subtotal: Float!
}

type Address {
  street: String
  city: String
  state: String
  zipCode: String
}

type Share {
  shareId: ID!
  profileId: ID!
  targetAccountId: ID!
  targetAccount: Account
  permissions: [PermissionType!]!
  createdAt: AWSDateTime!
  createdByAccountId: ID!
}

# Lightweight share info (deprecated - use SharedProfile from listMyShares)
type ShareInfo {
  profileId: ID!
  permissions: [PermissionType!]!
}

# Full profile data with share permissions - returned by listMyShares
type SharedProfile {
  profileId: ID!
  ownerAccountId: ID!
  sellerName: String!
  unitType: String
  unitNumber: Int
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
  isOwner: Boolean!
  permissions: [PermissionType!]!
}

type ProfileInvite {
  inviteCode: ID!
  profileId: ID!
  permissions: [PermissionType!]!
  expiresAt: AWSDateTime!
  createdAt: AWSDateTime!
  createdByAccountId: ID!
}

type UnitReport {
  unitType: String!
  unitNumber: Int!
  seasonName: String!
  seasonYear: Int!
  sellers: [UnitSellerSummary!]!
  totalSales: Float!
  totalOrders: Int!
}

type UnitSellerSummary {
  profileId: ID!
  sellerName: String!
  totalSales: Float!
  orderCount: Int!
  orders: [UnitOrderDetail!]!
}

type UnitOrderDetail {
  orderId: ID!
  customerName: String!
  orderDate: AWSDateTime!
  totalAmount: Float!
  lineItems: [LineItem!]!
}

type SeasonReport {
  reportId: ID!
  seasonId: ID!
  profileId: ID!
  reportUrl: AWSURL
  status: String!
  createdAt: AWSDateTime!
  expiresAt: AWSDateTime
}

# ============================================================================
# Input Types
# ============================================================================

input CreateSellerProfileInput {
  sellerName: String!
}

input UpdateSellerProfileInput {
  profileId: ID!
  sellerName: String!
}

input CreateSeasonInput {
  profileId: ID!
  seasonName: String
  seasonYear: Int
  startDate: AWSDateTime
  endDate: AWSDateTime
  catalogId: ID
  unitType: String
  unitNumber: Int
  city: String
  state: String
  prefillCode: String
  shareWithCreator: Boolean
}

input UpdateSeasonInput {
  seasonId: ID!
  seasonName: String
  seasonYear: Int
  startDate: AWSDateTime
  endDate: AWSDateTime
  catalogId: ID
}

input CreateCatalogInput {
  catalogName: String!
  isPublic: Boolean!
  products: [ProductInput!]!
}

input ProductInput {
  productName: String!
  description: String
  price: Float!
  sortOrder: Int!
}

input CreateOrderInput {
  profileId: ID!
  seasonId: ID!
  customerName: String!
  customerPhone: String
  customerAddress: AddressInput
  orderDate: AWSDateTime!
  paymentMethod: PaymentMethod!
  lineItems: [LineItemInput!]!
  notes: String
}

input UpdateOrderInput {
  orderId: ID!
  customerName: String
  customerPhone: String
  customerAddress: AddressInput
  orderDate: AWSDateTime
  paymentMethod: PaymentMethod
  lineItems: [LineItemInput!]
  notes: String
}

input LineItemInput {
  productId: ID!
  quantity: Int!
}

input AddressInput {
  street: String
  city: String
  state: String
  zipCode: String
}

input CreateCampaignPrefillInput {
  catalogId: ID!
  seasonName: String!
  seasonYear: Int!
  startDate: AWSDate
  endDate: AWSDate
  unitType: String!
  unitNumber: Int!
  city: String!
  state: String!
  creatorMessage: String!
  description: String
}

input UpdateCampaignPrefillInput {
  prefillCode: String!
  creatorMessage: String
  description: String
  isActive: Boolean
}

input CreateProfileInviteInput {
  profileId: ID!
  permissions: [PermissionType!]!
  expiresInDays: Int
}

input RedeemProfileInviteInput {
  inviteCode: ID!
}

input ShareProfileDirectInput {
  profileId: ID!
  targetAccountEmail: AWSEmail!
  permissions: [PermissionType!]!
}

input RevokeShareInput {
  profileId: ID!
  targetAccountId: ID!
}

input UpdateMyAccountInput {
  givenName: String
  familyName: String
  city: String
  state: String
  unitType: String
  unitNumber: Int
}

input RequestSeasonReportInput {
  seasonId: ID!
  format: String
}

# ============================================================================
# Query Root
# ============================================================================

type Query {
  # Account queries
  getMyAccount: Account!
  
  # Profile queries
  getProfile(profileId: ID!): SellerProfile
  listMyProfiles: [SellerProfile!]!
  listMyShares: [SharedProfile!]!
  
  # Season queries
  getSeason(seasonId: ID!): Season
  listSeasonsByProfile(profileId: ID!): [Season!]!
  
  # Catalog queries
  getCatalog(catalogId: ID!): Catalog @aws_cognito_user_pools
  listPublicCatalogs: [Catalog!]! @aws_cognito_user_pools
  listMyCatalogs: [Catalog!]!
  
  # Order queries
  getOrder(orderId: ID!): Order
  listOrdersBySeason(seasonId: ID!): [Order!]!
  listOrdersByProfile(profileId: ID!): [Order!]!
  
  # Share queries
  listSharesByProfile(profileId: ID!): [Share!]!
  listInvitesByProfile(profileId: ID!): [ProfileInvite!]!
  
  # Campaign prefill queries
  getCampaignPrefill(prefillCode: String!): CampaignPrefill
  listMyCampaignPrefills: [CampaignPrefill!]!
  findCampaignPrefills(unitType: String!, unitNumber: Int!, city: String!, state: String!, seasonName: String!, seasonYear: Int!): [CampaignPrefill!]!
  
  # Unit reporting
  listUnitCatalogs(unitType: String!, unitNumber: Int!, seasonName: String!, seasonYear: Int!): [Catalog!]!
  listUnitSeasonCatalogs(unitType: String!, unitNumber: Int!, city: String!, state: String!, seasonName: String!, seasonYear: Int!): [Catalog!]!
  getUnitReport(unitType: String!, unitNumber: Int!, city: String, state: String, seasonName: String!, seasonYear: Int!, catalogId: ID!): UnitReport
}

# ============================================================================
# Mutation Root
# ============================================================================

type Mutation {
  # Account mutations
  updateMyAccount(input: UpdateMyAccountInput!): Account!
  updateMyPreferences(preferences: AWSJSON!): Account!
  
  # Profile mutations
  createSellerProfile(input: CreateSellerProfileInput!): SellerProfile!
  updateSellerProfile(input: UpdateSellerProfileInput!): SellerProfile!
  deleteSellerProfile(profileId: ID!): Boolean!
  
  # Season mutations
  createSeason(input: CreateSeasonInput!): Season!
  updateSeason(input: UpdateSeasonInput!): Season!
  deleteSeason(seasonId: ID!): Boolean!
  
  # Catalog mutations
  createCatalog(input: CreateCatalogInput!): Catalog!
  updateCatalog(catalogId: ID!, input: CreateCatalogInput!): Catalog!
  deleteCatalog(catalogId: ID!): Boolean!
  
  # Order mutations
  createOrder(input: CreateOrderInput!): Order!
  updateOrder(input: UpdateOrderInput!): Order!
  deleteOrder(orderId: ID!): Boolean!
  
  # Campaign prefill mutations
  createCampaignPrefill(input: CreateCampaignPrefillInput!): CampaignPrefill!
  
  updateCampaignPrefill(input: UpdateCampaignPrefillInput!): CampaignPrefill!
  
  deleteCampaignPrefill(prefillCode: String!): Boolean!
  
  # Sharing mutations
  createProfileInvite(input: CreateProfileInviteInput!): ProfileInvite!
  deleteProfileInvite(profileId: ID!, inviteCode: ID!): Boolean!
  redeemProfileInvite(input: RedeemProfileInviteInput!): Share!
  shareProfileDirect(input: ShareProfileDirectInput!): Share!
  revokeShare(input: RevokeShareInput!): Boolean!
  
  # Report generation
  requestSeasonReport(input: RequestSeasonReportInput!): SeasonReport!
}

# ============================================================================
# Schema Root
# ============================================================================

schema {
  query: Query
  mutation: Mutation
}
